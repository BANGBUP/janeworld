
# 유아동 학습형 게임 앱 설계 문서

## 1. 목표 및 개요

- **타깃 디바이스**: 10인치 안드로이드 패드(우선), 향후 아이패드 포함 멀티 포팅
- **핵심 컨셉**
  - 아이가 **패드에 직접 그린 그림** 또는 **종이에 그린 그림을 촬영한 이미지**를
  - AI 서버에 보내서 **캐릭터로 변환**
  - 변환된 캐릭터를 여러 **학습용 미니게임**에서 반복적으로 활용
- **게임 유형 예시**
  - 모양/색깔 맞추기
  - 퍼즐 조각 맞추기
  - 눈-손 협응용 터치 게임
  - 메모리 플래시카드 게임
  - 숫자/문자 학습 게임
  - 음성 기반 코딩형 만화 스토리 게임

---

## 2. 전체 시스템 아키텍처

### 2.1 클라이언트(패드 앱)

- **프레임워크**: Flutter
  - 안드로이드 + iOS(아이패드) 동시 지원
  - 일반 UI(메뉴, 설정, 부모 화면 등)를 Flutter 위젯으로 구성
- **게임 엔진**: Flame (Flutter 기반 2D 게임 엔진)
  - 2D 학습 게임에 적합, 멀티플랫폼 빌드 가능
  - 공통 게임 루프, 입력 처리, 애니메이션, 충돌 처리 등 지원
- **주요 기능**
  - 그림 그리기 캔버스(패드 화면에 직접 드로잉)
  - 카메라 촬영 및 갤러리 이미지 선택
  - 미니게임 실행(각 게임은 모듈화)
  - 음성 녹음 및 AI 서버 전송
  - 오프라인 캐싱(인터넷이 없어도 기존 다운로드 콘텐츠로 플레이 가능)

### 2.2 백엔드 서버

1. **메인 백엔드(API 서버)**
   - 사용자/부모 계정 관리
   - 아이 프로필 관리(여러 명)
   - 게임 목록, 레벨 정보, 난이도/스킬 태그 제공
   - 학습 진행도, 점수, 플레이 로그 저장

2. **AI 이미지 서버**
   - 입력: 사용자가 그린 그림(캔버스 PNG 또는 사진)
   - 처리:
     - 배경 제거, 윤곽 추출, 색 보정
     - Image-to-Image 모델로 게임용 캐릭터 스타일로 변환
   - 출력:
     - 투명 PNG 캐릭터 스프라이트(최소 1프레임, 가능하면 여러 포즈)
     - 캐릭터 메타데이터(이름, 색상, 타입 등)

3. **AI 스토리/코딩 서버**
   - 음성 → 텍스트(STT)
   - 텍스트 → 코딩 블록/스토리 시퀀스로 변환(LLM 기반)
   - 만화 장면 구성(어떤 캐릭터가, 어느 배경에서, 무엇을 하는지)

4. **저장소**
   - 객체 스토리지(S3/GCS 등): 캐릭터 이미지, 배경, 사운드 등
   - RDB(PostgreSQL 등): 사용자/아이, 게임, 레벨, 진행도, 스토리 프로젝트 등

---

## 3. 클라이언트 앱 구조 설계

### 3.1 레이어 구조

1. **Presentation Layer (UI)**
   - 홈/대시보드
     - 오늘의 추천 게임
     - 최근에 사용한 캐릭터
   - 아이 프로필 선택/추가 화면
   - 게임 선택 화면
     - 연령, 스킬(색, 모양, 숫자, 언어, 눈-손 협응 등) 필터
   - 그림 → 캐릭터 생성 마법사
   - 부모 전용 설정/리포트 화면

2. **Game Layer (Flame 엔진)**

   - 공통 엔진/프레임워크
     - 게임 상태 관리(시작, 일시정지, 재시작, 종료)
     - 공통 UI(큰 버튼, 점수/시간 표시, 팝업)
     - 공통 사운드 관리(효과음, 배경음)
   - 미니게임 모듈(예시)
     - `ShapeColorGame`: 모양/색 맞추기
     - `PuzzleGame`: 조각 퍼즐
     - `TapCoordinationGame`: 터치 반응 게임
     - `MemoryCardGame`: 플래시카드/메모리
     - `NumberLetterGame`: 숫자/문자 학습
     - `StoryCodingGame`: 음성 기반 스토리 코딩

3. **Domain Layer**
   - 주요 도메인 모델
     - `ChildProfile`, `Character`, `Game`, `Level`, `SkillTag`, `GameSession`, `GameResult`
   - 레벨 업/잠금 해제 로직
   - 추천 게임 로직(아이의 약한 스킬 보완)

4. **Data Layer**
   - API 클라이언트(REST/GraphQL)
   - 로컬 저장(SQLite/Hive 등)
   - 이미지/캐릭터 스프라이트 캐싱

### 3.2 미니게임 인터페이스 설계

미니게임을 쉽게 추가/교체할 수 있도록 공통 인터페이스 정의:

```dart
abstract class MiniGame {
  String get gameId;          // "shape_color", "puzzle" 등
  List<String> get skillTags; // ["color", "shape", "hand_eye"]

  Future<void> loadContent(LevelConfig config, List<Character> characters);
  void start();
  void pause();
  void resume();
  void dispose();

  GameResult getResult();     // 점수/성취도/플레이 시간 등
}
```

- 앱은 서버에서 `GameConfig` 및 `LevelConfig`를 내려받고
- 해당 게임 ID에 맞는 `MiniGame` 구현체를 불러서 실행
- 캐릭터 목록, 배경, 레벨 설정을 주입하는 구조

### 3.3 데이터 드리븐 레벨 구성

앱을 자주 업데이트하지 않고도 새로운 레벨을 공급하기 위해, 게임 룰은 코드에 두고 **콘텐츠와 난이도는 JSON**으로 관리.

예시(JSON):

```json
{
  "game_id": "shape_color",
  "level": 3,
  "skills": ["color", "shape"],
  "target": {
    "shape": "circle",
    "color": "red"
  },
  "choices": [
    {"shape": "circle", "color": "red"},
    {"shape": "square", "color": "red"},
    {"shape": "circle", "color": "blue"}
  ],
  "time_limit_sec": 30
}
```

- 서버에서 콘텐츠를 바꿔주면, 앱은 그대로 JSON을 읽어서 새로운 레벨을 구성
- 플래시카드, 숫자/문자 학습 게임도 같은 방식으로 단어/숫자/이미지/음성 파일 경로를 JSON으로 관리

---

## 4. AI 캐릭터 생성 파이프라인

### 4.1 입력 방식

1. **패드 드로잉**
   - Flutter Canvas에 아이가 손가락/펜으로 그림
   - 완료 후 PNG로 추출하여 업로드

2. **종이 그림 촬영**
   - 카메라 촬영 → 자동 크롭(윤곽 검출)
   - 밝기/대비 보정, 그림만 남도록 보정

### 4.2 서버 처리 단계

1. **전처리 서비스**
   - 배경 제거(세그멘테이션 모델)
   - 윤곽 정리 및 노이즈 제거
   - 정사각형 캔버스로 패딩, 표준 해상도로 리사이즈

2. **캐릭터 생성 서비스**
   - Image-to-Image 모델에
     - "아이 느낌을 유지하면서도 게임용 캐릭터로 정리"
   - 출력:
     - 투명 PNG 캐릭터(Idle 기본 포즈, 필요시 추가 포즈)
   - 메타데이터:
     - `character_id`
     - 주요 색상, 카테고리(동물, 사람, 로봇 등)
     - 아이와의 매핑 정보

3. **저장 & API**

- 스프라이트 파일: 객체 스토리지에 저장
- DB: 캐릭터 메타데이터 + 파일 경로
- 주요 API 예시
  - `POST /characters` : 이미지 업로드 → 캐릭터 생성 요청
  - `GET /characters?child_id=...` : 특정 아이의 캐릭터 목록
  - `GET /characters/{id}/assets` : 이미지 경로, 스프라이트 정보 제공

### 4.3 게임에서 활용

- 미니게임 공통 규칙:
  - 현재 선택된 캐릭터 목록을 전달받아서
    - 주인공/가이드 캐릭터로 사용
    - 퍼즐 그림, 맞추기 타겟, 플래시카드 그림 등으로 재사용
- 아이는 “자기가 만든 캐릭터”가 여러 게임에 등장하는 경험을 하게 되어 몰입도와 애착이 증가

---

## 5. 주요 미니게임별 설계 방향

### 5.1 모양/색깔 맞추기 게임

- 스킬: 색 인지, 형태 인지, 1:1 매칭
- 구조
  - 타깃 모양/색 1개 + 여러 선택지
  - 드래그 앤 드롭 또는 탭 선택
- 난이도 조절
  - 유사한 색/모양(예: 파랑 vs 하늘색, 원 vs 타원)
  - 시간 제한, 방해 요소 추가

### 5.2 퍼즐 조각 맞추기 게임

- 스킬: 공간 지각, 문제 해결력
- 구조
  - 캐릭터/배경 이미지를 2x2, 3x3, 4x4 등의 그리드로 분할
  - 섞어서 빈 칸에 맞추는 퍼즐
- 난이도
  - 조각 수 증가
  - 그림 디테일과 패턴 난이도 조절

### 5.3 눈-손 협응 터치 게임

- 스킬: 반응 속도, 주의 집중
- 구조
  - 화면에 랜덤 위치로 캐릭터/아이템 등장
  - 제한 시간 안에 터치
- 난이도
  - 등장 속도 조절
  - 한 번에 등장하는 개수 조절
  - 가짜(터치하면 감점되는) 오브젝트 추가 가능

### 5.4 메모리 플래시카드 게임

- 스킬: 기억력, 언어 능력
- 구조
  - 단어 ↔ 그림, 문자 ↔ 발음 쌍으로 카드 구성
  - 뒤집기(메모리) 모드: 같은 쌍 찾기
  - 학습 모드: 카드 보여주고 소리 들려주기, 따라 말하게 하기
- 데이터
  - JSON으로 단어, 이미지, 음성 파일 경로, 예문 등을 정의

### 5.5 숫자/문자 학습 게임

- 스킬: 수 개념, 문자 인식
- 예시
  - 사과 3개가 보이면 “3”을 선택
  - 숫자/한글/알파벳 모양을 따라 그리기(트레이싱)
  - “3” ↔ “three” ↔ 사과 3개 매칭 게임

### 5.6 음성 코딩형 만화 스토리 게임

- 컨셉
  - 아이가 말로 “토끼가 오른쪽으로 세 칸 가고, 점프하고, 웃으면서 인사해” 등 자연어로 말함
  - 서버에서 이를 제한된 명령어 셋으로 변환
    - `MoveRight(3)`
    - `Jump()`
    - `Emotion("Happy")`
    - `WaveHand()`
- UI 흐름
  - 음성 녹음 → 텍스트 변환(STT)
  - LLM이 텍스트를 “블록 시퀀스”로 변환
  - 화면 아래쪽에 코딩 블록 타임라인 표시
    - 블록을 드래그해서 순서 변경/삭제/추가
  - “재생”을 누르면 만화/애니메이션으로 실행
- 서버 역할
  - 어린이 발화를 안정적으로 처리하기 위해
    - 제한된 명령어 사전 정의
    - 부적절한 내용 필터링
  - LLM은 자연어 → 명령어 셋 매핑에 집중

---

## 6. 확장성과 멀티 포팅 전략

### 6.1 Flutter + Flame 기반

- Flutter
  - 안드로이드, iOS, 웹, 데스크톱 빌드 가능
- Flame
  - Flutter 위의 2D 게임 엔진
  - 교육용 2D 게임에 성능 충분, 구현도 간단
- 전략
  - **v1**: Flutter + Flame으로 안드로이드/아이패드 동시 지원
  - **v2 이후**: 필요하다면 일부 특수 게임만 Unity/네이티브로 별도 개발 후 연동

### 6.2 새 게임 추가 전략

- 미리 “게임 패턴 템플릿”을 정의
  - 매칭형, 정렬형, 시퀀스형, 플래시카드형, 트레이싱형 등
- 최대한 데이터(이미지/단어/난이도 설정)만 바꿔서 새로운 학습 콘텐츠를 공급
- 완전히 새로운 룰의 게임은
  - `MiniGame` 인터페이스를 구현하는 새로운 모듈로 추가
  - 앱 업데이트로 배포

---

## 7. 계정/데이터 구조 및 프라이버시

### 7.1 데이터 모델(간략)

- User : 부모 계정
- ChildProfile : 아이 프로필 (여러 명)
- Character : 아이 그림 기반 캐릭터
- Game / Level / SkillTag : 게임 및 레벨 정의
- Progress : 아이별 레벨/게임별 진행도, 점수
- StoryProject : 스토리 코딩 결과물

### 7.2 어린이 서비스 특성 고려

- 개인정보 최소 수집
  - 프로필 사진 대신 캐릭터/아바타 중심
  - 이름도 닉네임 사용 가능
- 광고 지양, 외부 링크 최소화
- AI 이미지/스토리는 “어린이용 안전 모드 프롬프트”로 제한
- 부모용 화면
  - 오늘 총 플레이 시간
  - 어떤 스킬(색, 모양, 숫자, 문자, 기억력 등)을 많이/적게 했는지
  - 다음 추천 활동(예: 색 → 모양 → 숫자 순으로 난이도 조절)

---

## 8. 개발 로드맵 예시

### 1단계(MVP)

- Flutter 앱 기본 골격
  - 아이 프로필 선택, 게임 선택 화면
- 그림 → 캐릭터 생성(Idle 이미지 1장 기준)
- 기본 미니게임 2종
  - ShapeColorGame
  - FlashcardGame
- 진행도 로컬 저장(서버 없이도 동작)

### 2단계

- 퍼즐 게임 + 눈-손 협응 게임 추가
- 서버 연동(로그인, 프로필, 레벨/콘텐츠 서버 제공)
- 캐릭터를 모든 게임에 통합(주인공/가이드화)

### 3단계

- 음성 기반 코딩형 스토리 게임 추가
- STT/LLM 서버 연동 및 어린이용 명령어 셋 정리
- 만들어진 스토리를 프로젝트로 저장/재생

### 4단계

- 웹/PC 버전(부모용 대시보드 포함)
- 학습 리포트 및 통계 기능 강화
- 더 많은 템플릿형 학습 게임 추가

---

## 9. 마무리

이 설계는 다음을 목표로 합니다.

1. **플랫폼 확장성**: Flutter + Flame 조합으로 안드로이드/아이패드/웹까지 대응
2. **콘텐츠 확장성**: 게임 규칙은 코드에, 레벨/콘텐츠는 JSON/서버로 관리
3. **아이 중심 경험**: 아이가 그린 캐릭터가 모든 게임 속에서 살아 움직이게 설계
4. **부모/교육용 관점**: 스킬 태그 기반 진행도/통계를 통해 학습 도구로 활용

이 문서를 기반으로 실제 프로젝트 구조(폴더 구조, Flutter/서버 스택 선택, DB 스키마 등)를 더 구체화하여 다음 단계로 진행할 수 있습니다.
